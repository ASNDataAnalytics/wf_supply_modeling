---
title: "Estimates for FTE Probabilities by Age & Sex"
format: html
execute: 
  echo: false
  warning: false
---

```{r}
#| label: Packages
#| echo: false
#| warning: false

require(asn)
require(tidyverse)
```

## From UNC Sheps Article

<https://data.asn-online.org/posts/neph_wf_trends/>

UNC Sheps estimated probability of clinical FTE by sex and age using data from NC. See this section from their report:

### 2.4 Modeling FTE

The UNC model forecasts both the headcount and FTE of the nephrology workforce. The AMA Masterfile does not contain hours worked so we used licensure data from the North Carolina Health Professions Data System (HPDS) to estimate nephrology FTEs. Using these data, 1 FTE in nephrology is equivalent to 70 patient care hours per week. The HPDS data also show that the FTE of individual physicians varies depending on age and gender. To model individual physician FTEs, the UNC model makes the simplifying approach of grouping physicians into three categories:

-   Those working full time, i.e. FTE = 1

-   Those working part time, i.e. FTE = 0.5

-   Those not providing any patient care, i.e. FTE = 0

The UNC model assigns a FTE to a given physician depending on the probabilities of providing patient care full time, part time or not at all depending on the age and gender of the physician. These probabilities are illustrated in Figure 9.

#### Figure 9. UNC Model: Probability of Providing Full-Time Patient Care by Sex and Age

![](prob_fte.png)

The chart shows for males, the probability of working part time increases with age – indicated by the widening of the orange band. However, for female physicians the probability of not providing any patient care increases from age 50 through to 80 – indicated by the increasing grey region. It is important to note that the FTE calculations for females over 50 is based on a small number of physicians and therefore may not be a good predictor of the behavior of future older female nephrologists.

## Extracting Data

I used Plot Digitizer (<https://plotdigitizer.com/app>) to extract the probability curves.

This extracted the following probabilities.

### 1. Male—*P*(PCFTE=1)

```{r}

men_fulltime <- 
  tibble::tribble(
  ~x,                 ~y,                
  30.15725518227305,  0.6380434782608696,
  30.90421729807005,  0.6358695652173914,
  31.847748391708365, 0.6282608695652174,
  32.673338098641885, 0.6239130434782609,
  33.42030021443888,  0.6195652173913043,
  34.32451751250893,  0.6152173913043478,
  35.07147962830593,  0.6119565217391304,
  35.97569692637598,  0.6054347826086957,
  37.07648320228735,  0.6021739130434782,
  38.413152251608295, 0.5967391304347827,
  39.00285918513224,  0.5956521739130435,
  40.30021443888492,  0.591304348,       
  41.479628305932806, 0.5869565217391305,
  42.54110078627591,  0.5858695652173913,
  43.406004288777694, 0.5847826086956521,
  44.074338813438175, 0.5836956521739131,
  44.93924231593996,  0.5826086956521739,
  45.76483202287348,  0.5804347826086956,
  46.35453895639743,  0.5815217391304348,
  47.29807005003574,  0.5815217391304348,
  48.280914939242315, 0.5793478260869566,
  48.98856325947105,  0.5793478260869566,
  50.285918513223734, 0.5815217391304348,
  49.61758398856326,  0.5804347826086956,
  51.42601858470336,  0.5847826086956521,
  52.05503931379557,  0.5836956521739131,
  52.802001429592565, 0.5847826086956521,
  53.62759113652609,  0.5869565217391305,
  54.531808434596144, 0.5880434782608696,
  55.75053609721229,  0.592391304,       
  55.082201572551824, 0.592391304,       
  56.536812008577556, 0.5956521739130435,
  57.36240171551108,  0.5967391304347827,
  58.58112937812723,  0.6010869565217392,
  59.367405289492496, 0.6065217391304348,
  60.468191565403856, 0.6108695652173913,
  61.76554681915654,  0.6195652173913043,
  62.55182273,        0.6260869565217392,
  63.96711937097927,  0.6315217391304347,
  65.30378842030021,  0.6434782608695653,
  66.60114367,        0.6478260869565218,
  67.74124374553253,  0.6554347826086957,
  68.52751966,        0.6663043478260869,
  70.21801287,        0.6739130434782609,
  71.43674052894926,  0.683695652,       
  72.93066476054324,  0.6967391304347826,
  74.18870621872767,  0.7097826086956521,
  75.52537527,        0.7195652173913043,
  76.78341672623303,  0.7336956521739131,
  77.84488920657613,  0.7456521739130435,
  78.63116511794138,  0.7565217391304347,
  80.00714796,        0.7684782608695653,
  80.59685489635454,  0.775,             
  82.13009292,        0.7923913043478261,
  83.23087919942816,  0.8108695652173913,
  84.41029306647606,  0.8217391304347826,
  85.03931379556826,  0.8315217391304348
  ) |> 
  mutate(
    y = 1 - y
  ) |> 
  rename(
    age = x, 
    p_fte = y
  )

```

### 2. Male—*P*(PCFTE=0)

```{r}
men_no_fte <-
  tibble::tribble(
    ~x,                 ~y,                  
    30.196568977841316, 0.13478260869565217, 
    30.982844889206575, 0.1391304347826087,  
    31.92637598284489,  0.1423913043478261,  
    32.90922087205146,  0.1423913043478261,  
    34.12794853466762,  0.14673913043478262, 
    35.07147962830593,  0.15,                
    35.93638313080772,  0.15,                
    37.273052180128666, 0.15543478260869564, 
    36.72265904217298,  0.15217391304347827, 
    38.25589706933524,  0.1565217391304348,  
    39.08148677626876,  0.1565217391304348,  
    40.025017869907074, 0.15760869565217392, 
    41.04717655468192,  0.15869565217391304, 
    42.030021443888494, 0.15978260869565217, 
    42.81629735525375,  0.16086956521739132, 
    43.68120085775554,  0.16195652173913044, 
    44.821300929235164, 0.16195652173913044, 
    45.489635453895644, 0.16195652173913044, 
    46.47248034310222,  0.16630434782608697, 
    47.455325232308795, 0.1641304347826087,  
    48.71336669049321,  0.16521739130434782, 
    50.08934953538242,  0.1641304347826087,  
    51.26876340243031,  0.16195652173913044, 
    52.251608291636884, 0.16304347826086957, 
    53.50964974982131,  0.16086956521739132, 
    55.00357398,        0.15869565217391304, 
    56.37955682630451,  0.15760869565217392, 
    57.48034310221587,  0.1565217391304348,  
    58.58112937812723,  0.15434782608695652, 
    59.52466047176554,  0.15217391304347827, 
    60.54681915654039,  0.15,                
    61.41172265904217,  0.14891304347826087, 
    62.473195139385275, 0.14565217391304347, 
    63.69192280200143,  0.1423913043478261,  
    64.51751250893496,  0.1391304347826087,  
    65.53967119,        0.1358695652173913,  
    66.52251608291637,  0.13152173913043477, 
    67.34810579,        0.12717391304347828, 
    68.33095067905647,  0.12608695652173912, 
    69.19585418155826,  0.12282608695652174, 
    69.90350250178699,  0.12065217391304348, 
    70.88634739099356,  0.11630434782608695, 
    71.79056468906361,  0.10978260869565218, 
    72.45889921,        0.10869565217391304, 
    73.20586132952108,  0.10326086956521739, 
    73.87419585418155,  0.1,                 
    74.66047176554682,  0.09673913,          
    75.40743388134382,  0.095652174,         
    76.03645461043602,  0.092391304,         
    76.78341672623303,  0.090217391,         
    77.60900643316654,  0.085869565,         
    78.35596854896355,  0.080434783,         
    78.98498927805576,  0.076086957,         
    79.61401000714797,  0.07173913,          
    80.36097212294496,  0.068478261,         
    81.18656182987849,  0.061956522,         
    81.97283774124375,  0.057608695652173914,
    82.83774124374554,  0.051086956521739134,
    83.82058613295212,  0.044565217,         
    84.60686204431738,  0.038043478,         
    85.07862759113652,  0.031521739
  ) |> 
  rename(
    age = x, 
    p_no_fte = y
  )
```

### 3. Female—*P*(PCFTE=1)

```{r}

women_fulltime <- 
  tibble::tribble(
  ~x,                 ~y,                
  30.010937073919255, 0.6500956022944551,
  30.66726165625816,  0.6421287055225263,
  31.37828262438353,  0.635755258,       
  31.870526061137706, 0.6341619254526171,
  32.41746187779101,  0.6277883613542662,
  33.456645137085836, 0.6230082466315129,
  33.456645137085836, 0.6230082466315129,
  34.00357695,        0.621414914,       
  34.55051677039244,  0.6166347992351816,
  35.206841352731345, 0.6166347992351816,
  36.02724708065497,  0.6134480171860062,
  36.68357166299388,  0.6102613518388503,
  37.503977390917505, 0.6086679024632529,
  38.26968673305466,  0.6086679024632529,
  39.41825475214774,  0.6038877877404994,
  40.566822771240815, 0.6022944550669216,
  41.27784373936619,  0.6022944550669216,
  42.15294585307629,  0.6007011223933437,
  43.02803996,        0.6007011223933437,
  43.739060923137075, 0.6038877877404994,
  44.50477026527423,  0.605481237,       
  45.32517599319786,  0.6038877877404994,
  46.36435925249268,  0.6022944550669216,
  47.13006859462984,  0.6070745697896749,
  48.11455546813819,  0.605481237,       
  48.88027282205003,  0.6070745697896749,
  49.91944806957017,  0.6086679024632529,
  50.411691506324345, 0.6134480171860062,
  51.17740886,        0.6166347992351816,
  52.10719934795807,  0.619821581,       
  53.14638261,        0.6261950286806883,
  53.96678833517653,  0.6309751434034416,
  54.84188243711194,  0.635755258,       
  55.388822259652585, 0.6405353728489483,
  55.935762082193236, 0.6469088202452796,
  56.64677503854392,  0.6532823843436305,
  57.46718076646755,  0.6596558317399618,
  58.17820173459292,  0.666029279,       
  58.88922270271829,  0.6676227285118905,
  59.54554729,        0.6755895085817997,
  60.14717548160963,  0.6819630143291407,
  60.69411530415027,  0.6899299111010695,
  61.40512826050096,  0.6978967495219885,
  62.170845614412805, 0.7010834732201542,
  62.82717019675171,  0.7074569789674952,
  63.592879538888866, 0.7154238173884142,
  64.19450774,        0.7217973231357553,
  64.79614394376841,  0.7297641615566742,
  65.39777214032085,  0.7361376673040153,
  65.89001557707502,  0.7441045057249343,
  66.38225901,        0.7488846204476876,
  66.92919883636985,  0.7552581261950286,
  67.53082703292228,  0.7648183556405354,
  67.96837408388998,  0.7727851940614543,
  68.57001029221709,  0.7839388145315487,
  69.11694210298306,  0.7919056529524677,
  69.66388192552371,  0.7998725497243965,
  70.15612536227789,  0.8078393881453154,
  70.81244994461679,  0.8158062265662345,
  71.52347091274217,  0.8269598470363289,
  72.12509911,        0.8365200764818356,
  72.83612007741996,  0.847673697,       
  73.54713303377065,  0.8588272590710145,
  74.31285038768249,  0.8699808795411089,
  74.75039744,        0.8827278326847813,
  75.51610678078737,  0.892288062,       
  76.00835021754153,  0.9018482915757947,
  76.60998642586866,  0.9082217973231357,
  77.21161462242108,  0.9257488651895613,
  77.64916167338879,  0.9321223709369024,
  77.97732396455824,  0.9400892093578215,
  78.36018264151417,  0.9448693240805748,
  78.74304131847009,  0.9560229445506692,
  79.23528475522426,  0.9655831739961759,
  79.56344704639372,  0.9703632887189292,
  80.00099409736143,  0.9799235181644359,
  80.43854114832912,  0.9878903565853548,
  80.82139982528506,  0.9958572533572837
  ) |>
  mutate(
    y = 1 - y
  ) |> 
  rename(
    age = x, 
    p_fte = y
  )

```

### 4. Female—*P*(PCFTE=0)

```{r}

women_no_fte <- 
  tibble::tribble(
  ~x,                 ~y,                  
  30.065633459705726, 0.21669849519747847, 
  30.61256927635903,  0.2087317151275693,  
  31.05012033321408,  0.20076481835564053, 
  31.597056149867385, 0.1848311415138026,  
  32.14399196652069,  0.17527091206829587, 
  32.472158263577484, 0.1673040152963671,  
  32.80032055474693,  0.15933711852443833, 
  33.347252365512894, 0.14977688907893164, 
  34.00357695,        0.14181010900902247, 
  34.00357695,        0.14181010900902247, 
  34.823982675775426, 0.12428298279158699, 
  34.55051677039244,  0.1338432122370937,  
  35.42561888410254,  0.1147227533460803,  
  36.02724708065497,  0.10356919122699569, 
  36.79295642279213,  0.10197574185139818, 
  37.28519985954631,  0.09082218,          
  37.72275492,        0.084448732,         
  38.21499835904287,  0.08126195,          
  38.54316065021233,  0.076481836,         
  39.144788846764754, 0.070108388,         
  39.58233589773246,  0.066921606,         
  40.183972106059585, 0.065328273,         
  40.67621554281376,  0.057361377,         
  41.22314735357972,  0.04939448,          
  41.77008717612037,  0.046207815,         
  42.15294585307629,  0.043021032504780114,
  42.75457404962872,  0.043021032504780114,
  43.246817486382895, 0.03983425,          
  43.84844568293533,  0.036647585,         
  44.231304359891254, 0.036647585,         
  44.77824418,        0.035054135732851335,
  45.43456876,        0.030274021,         
  46.14558172112149,  0.028680688336520075,
  47.13006859462984,  0.030274021,         
  46.63782515787567,  0.031867470385695505,
  47.62231203138401,  0.030274021,         
  48.33333299950939,  0.030274021,         
  49.153738727433016, 0.031867470385695505,
  49.91944806957017,  0.035054135732851335,
  50.52108427789729,  0.036647585,         
  51.17740886,        0.038240918,         
  51.72434067100215,  0.041427699831202196,
  52.21658410775633,  0.046207815,         
  52.81822031608345,  0.054174595,         
  53.41984851263588,  0.057361377,         
  53.85739556360359,  0.063734824,         
  54.67780129152722,  0.068514939,         
  55.06065996848314,  0.071701721,         
  55.66228816503556,  0.079668618,         
  56.15453160178974,  0.084448732,         
  56.59208666453213,  0.089228847,         
  57.08433010128631,  0.10038240917782026, 
  57.52187715225402,  0.10675585657415153, 
  58.17820173459292,  0.11312942067250238, 
  58.615748785560626, 0.12109620074241156, 
  59.107992222314806, 0.13065643018791825, 
  59.65493204485545,  0.13862332695984703, 
  60.25656024140788,  0.1465902237317758,  
  60.74880367816206,  0.16093056790003585, 
  61.18635874090445,  0.1673040152963671,  
  61.89737169725514,  0.18005102679104923, 
  62.33492675999753,  0.18642447418738048, 
  62.82717019675171,  0.1975780363064651,  
  63.37410200751767,  0.2055449330783939,  
  63.921041830058314, 0.21510516252390058, 
  64.41328527,        0.22466539196940727, 
  64.90552870356666,  0.2390057361376673,  
  65.5071569,         0.2533460803059273,  
  65.94471196286149,  0.2613129770778561,  
  66.38225901,        0.27724665391969405, 
  66.92919883636985,  0.2915869980879541,  
  67.36674588733754,  0.30592734225621415, 
  67.74960456429346,  0.31708090437529873, 
  68.35123276,        0.3330146979191563,  
  68.84347619760008,  0.342574927,         
  69.39041602014072,  0.36010193688007885, 
  69.71857831131018,  0.37125561570118304, 
  70.15612536227789,  0.3855959598694431,  
  70.53898403923381,  0.39356273993935226, 
  70.97653109020152,  0.4063097514340344,  
  71.41407814116923,  0.4238368776514699,  
  72.01571434949633,  0.43499043977055446, 
  72.28918025487931,  0.45092411661239246, 
  72.83612007741996,  0.47004457550340584, 
  73.21897074,        0.481198254,         
  73.71121417935538,  0.5003187132155235,  
  73.98468809651305,  0.5098789426610301,  
  74.42223514748075,  0.5226258374536926,  
  74.75039744,        0.5337795162747968,  
  75.13325611560612,  0.5528999751658102,  
  75.40672202,        0.5640535372848948,  
  75.78958069794503,  0.576800549,         
  76.22712774891272,  0.5991076730177461,  
  76.60998642586866,  0.605481237,         
  77.04753347683635,  0.6293818107298638,  
  77.43039215379228,  0.6421287055225263,  
  77.81324281897352,  0.6532823843436305,  
  78.30548625572769,  0.6771829579573972,  
  78.68834493,        0.6899299111010695,  
  79.18058837,        0.7074569789674952,  
  79.61813542,        0.7249840468339208,  
  79.83691295,        0.7441045057249343,  
  80.16507524294614,  0.753664735,         
  80.49323753,        0.7648183556405354,  
  80.71201506548678,  0.7775653087842077,  
  81.25894687625275,  0.796685768,         
  81.25894687625275,  0.796685768,         
  81.47772440762395,  0.8062459971207278,  
  82.02466423,        0.8285532380609165,  
  82.02466423,        0.8285532380609165,  
  82.35282652133404,  0.8413001912045889,  
  82.68098881,        0.8540471443482612,  
  82.95445471788648,  0.8795411089866156,  
  83.44669815464066,  0.8954748441794634,  
  83.77486045,        0.9177820267686424,  
  84.32180026835076,  0.9432759914069968,  
  83.93894159139484,  0.9305289799123148,  
  84.81404370510492,  0.9576163355752569,  
  84.81404370510492,  0.9576163355752569
  ) |> 
  rename(
    age = x, 
    p_no_fte = y
  )

```

## Standardizing Probabilities...and Extracting PCFTE=0.5

The problem with manually extracting this data....is that the x axis data is inconsistent. Need to revise so one `y` observation for each year $y$ where $x = 30, ..., 85$.

### 1. Male—*P*(PCFTE=1)

```{r}

men_fulltime <- 
  men_fulltime |> 
    mutate(
      age = map_int(age, ~.x %/% 1)
    ) |> 
    distinct(
      age,
      .keep_all = TRUE
  )

men_fulltime_missing <- 
  setdiff(
    30:85,
    men_fulltime |> pluck("age")
  )
  
men_fulltime <-
  men_fulltime |> 
  bind_rows(
    tibble(
      age = men_fulltime_missing,
      p_fte = NA_real_
    )
  ) |> 
  arrange(age) |> 
  mutate(
    p_fte = if_else(
      is.na(p_fte), lag(p_fte), p_fte
    )
  )  
```

### 2. Male—*P*(PCFTE=0)

```{r}

men_no_fte <- 
  men_no_fte |> 
  mutate(
    age = map_int(age, ~.x %/% 1)
  ) |> 
  distinct(
    age,
    .keep_all = TRUE
  ) 

men_no_fte_missing <- 
  setdiff(
    30:85,
    men_no_fte |> pluck("age")
  )
  
men_no_fte <-
  men_no_fte |> 
  bind_rows(
    tibble(
      age = men_no_fte_missing,
      p_no_fte = NA_real_
    )
  ) |> 
  arrange(age) |> 
  mutate(
    p_no_fte = if_else(
      is.na(p_no_fte), lag(p_no_fte), p_no_fte
    )
  ) 

```

### 3. Female—*P*(PCFTE=1)

```{r}

women_fulltime <- 
  women_fulltime |> 
    mutate(
      age = map_int(age, ~.x %/% 1)
    ) |> 
    distinct(
      age,
      .keep_all = TRUE
  )

women_fulltime_missing <- 
  setdiff(
    30:85,
    women_fulltime |> pluck("age")
  )
  
women_fulltime <-
  women_fulltime |> 
  bind_rows(
    tibble(
      age = women_fulltime_missing,
      p_fte = 0
    )
  ) |> 
  arrange(age) 

```

### 4. Female—*P*(PCFTE=0)

```{r}

women_no_fte <- 
  women_no_fte |> 
    mutate(
      age = map_int(age, ~.x %/% 1)
    ) |> 
    distinct(
      age,
      .keep_all = TRUE
  )

women_no_fte_missing <- 
  setdiff(
    30:85,
    women_no_fte |> pluck("age")
  )
  
women_no_fte <-
  women_no_fte |> 
  bind_rows(
    tibble(
      age = women_no_fte_missing,
      p_no_fte = 1
    )
  ) |> 
  arrange(age) 
```

### 5. Calculate Male—*P*(PCFTE=0.5)

```{r}
men_prob <- 
  men_fulltime |> 
  left_join(
    men_no_fte
  ) |> 
  rowwise() |> 
  mutate(
    p_half_fte = 1 - (p_fte + p_no_fte)
  ) |> 
  ungroup()

men_prob_long <- 
  men_prob |> 
  pivot_longer(
    names_to = "FTE",
    values_to = "Prob",
    cols = -age
  )

```

```{r}

ggplot(
  men_prob_long,
  aes(
    x = age, 
    y = Prob, 
    group = FTE
    )
  ) +
  geom_area(
    aes(
      fill = FTE
    )
  ) +
  scale_fill_asn() +
  theme_asn()

```

### 6. Calculate Female—*P*(PCFTE=0.5)

```{r}

women_prob <- 
  women_fulltime |> 
  left_join(
    women_no_fte
  ) |> 
  rowwise() |> 
  mutate(
    p_half_fte = 1 - (p_fte + p_no_fte)
  ) |> 
  ungroup()

women_prob_long <- 
  women_prob |> 
  pivot_longer(
    names_to = "FTE",
    values_to = "Prob",
    cols = -age
  )

```

```{r}

ggplot(
  women_prob_long,
  aes(
    x = age, 
    y = Prob, 
    group = FTE
    )
  ) +
  geom_area(
    aes(
      fill = FTE
    )
  ) +
  scale_fill_asn() +
  theme_asn()

```

